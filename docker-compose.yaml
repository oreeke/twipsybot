services:
  misskey-ai:
    build: .
    container_name: misskey-ai
    restart: unless-stopped

    volumes:
      # - ./plugins/your_plugin/config.yaml:/app/plugins/your_plugin/config.yaml:ro
      - ./data:/app/data
      - ./logs:/app/logs

    environment:
      - MISSKEY_INSTANCE_URL=https://misskey.example.com           # Misskey 实例 URL
      - MISSKEY_ACCESS_TOKEN=your_access_token_here                # Misskey 访问令牌
      - OPENAI_API_KEY=your_api_key_here                           # OpenAI API 密钥
      - OPENAI_MODEL=deepseek-chat                                 # 使用的模型名称
      - OPENAI_API_BASE=https://api.deepseek.com/v1                # OpenAI API 端点
      - OPENAI_API_MODE=auto                                       # auto/chat/responses
      - OPENAI_MAX_TOKENS=1000                                     # 最大生成 token 数
      - OPENAI_TEMPERATURE=0.8                                     # 温度参数
      - BOT_SYSTEM_PROMPT=你是一个可爱的AI助手...                    # 系统提示词（支持文件导入："prompts/*.txt"，"file://path/to/*.txt"）
      - BOT_AUTO_POST_ENABLED=true                                 # 是否启用自动发帖
      - BOT_AUTO_POST_INTERVAL=180                                 # 发帖间隔（分钟）
      - BOT_AUTO_POST_MAX_PER_DAY=8                                # 每日最大发帖数量（凌晨 0 点重置计数器）
      - BOT_AUTO_POST_VISIBILITY=public                            # 发帖可见性（public/home/followers）
      - BOT_AUTO_POST_LOCAL_ONLY=false                             # 是否禁用联合（仅本地可见）
      - BOT_AUTO_POST_PROMPT=生成一篇有趣、有见解的社交媒体帖子。      # 发帖提示词
      - BOT_RESPONSE_MENTION_ENABLED=true                          # 是否响应提及（@）
      - BOT_RESPONSE_CHAT_ENABLED=true                             # 是否响应聊天
      - BOT_RESPONSE_CHAT_MEMORY=10                                # 聊天上下文记忆长度（条）
      - BOT_TIMELINE_ENABLED=false                                 # 是否订阅时间线
      - BOT_TIMELINE_HOME=false                                    # homeTimeline
      - BOT_TIMELINE_LOCAL=false                                   # localTimeline
      - BOT_TIMELINE_HYBRID=false                                  # hybridTimeline
      - BOT_TIMELINE_GLOBAL=false                                  # globalTimeline
      - BOT_TIMELINE_ANTENNA_IDS=                                  # antenna ID 或名称（逗号/空格分隔）
      - LOG_LEVEL=INFO                                             # 日志级别 (DEBUG/INFO/WARNING/ERROR)
      - LOG_DUMP_EVENTS=false                                      # 是否输出事件原始数据（DEBUG）

    # env_file:
    #   - .env

    healthcheck:
      test: ["CMD", "python", "-c", "from src.utils import health_check; exit(0 if health_check() else 1)"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
